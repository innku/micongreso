<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load('visualization', '1', {packages: ['geomap','columnchart']});
  
  var states = [<%= State.google_codes_and_votes(@bill) %>]
  
  function drawStatesMap() {
    var data = new google.visualization.DataTable();
    data.addRows(states.length);
    data.addColumn('string', 'Estado');
    data.addColumn('number', '% Favor');
    data.addColumn('string', 'Nombre');
    
    for ( var i=0;i<states.length;i++){
      data.setValue(i,0,states[i][0]); //codigo entidad para mapa MX-
      data.setValue(i,1,states[i][2]);            //valor
      data.setValue(i,2,states[i][1]); //texto para mostrar
    }
    
    var geomap = new google.visualization.GeoMap(
        document.getElementById('citizen_votes_per_state'));
    geomap.draw(data,{'region':'MX', 'colors': [0xFFFFFF, 0x81A05A]});
  }
  
  google.setOnLoadCallback(drawStatesMap);
</script>

<% content_for :jQuery do -%>
  <%= javascript_include_tag "highcharts" %>
<% end -%>

<script type="text/javascript">
  $(document).ready(function(){
    var parties = [<%= Party.votes_per_party(@bill) %>]
    var party_names = $.map(parties, function(p) { return p[0]})
    
    new Highcharts.Chart({
      chart: {
        renderTo: "votes_per_party",
        defaultSeriesType: 'bar'
      },
      title: {
        text: null
      },
      xAxis: {
        categories: party_names
      },
      yAxis: {
         min: 0,
         title: {
            text: 'No. de Votos'
         }
      },
      plotOptions: {
         series: {
            stacking: 'normal'
         }
      },
      legend: {
         backgroundColor: '#FFFFFF',
         reversed: true
      },
      tooltip: {
         formatter: function() {
            return ''+
                this.series.name +': '+ this.y +'';
         }
      },
      series: [{
        name: 'A favor',
        color: '#89A54E',
        data: $.map(parties, function(p) {return p[1]})
      }, {
        name: 'En contra',
        color: '#AA4643',
        data: $.map(parties, function(p) {return p[2]})
      }, {
        name: 'Abstenciones',
        color: '#BBBBBB',
        data: $.map(parties, function(p) {return p[3]})
      }],
      credits: {
        enabled: false
      }
    });
  });
</script>

<script type="text/javascript">
  $(document).ready(function(){
    new Highcharts.Chart({
      chart: {
        renderTo: "official_votes"
      },
      title: {
        text: null
      },
      plotOptions: {
        pie: {
          size: "160%",
          allowPointSelect: true,
          cursor: 'pointer',
          center: [100, 100],
          dataLabels: {
             enabled: true,
             formatter: function() {
               if (this.y > 5) return this.point.name;
             },
             color: 'white',
             style: {
                font: '13px Trebuchet MS, Verdana, sans-serif'
             }
          }
        }
      },
      legend: {
         layout: 'vertical',
         style: {
            left: 'auto',
            bottom: 'auto',
            right: '90px',
            top: '100px'
         }
      },
      series: [{
        type: 'pie',
        data: [{
          name: 'A favor',
          color: '#89A54E',
          y: parseInt($('#official_votes').attr('data-for'))
        }, {
          name: 'En contra',
          color: '#AA4643',
          y: parseInt($('#official_votes').attr('data-against'))
        }, {
          name: 'Abstenciones',
          color: '#BBBBBB',
          y: parseInt($('#official_votes').attr('data-neutral'))
        }]
      }],
      tooltip: {
        formatter: function(){
          return "<b>Porcentage:</b> "+ Highcharts.numberFormat(this.percentage,2) + " %<br/>" + "<b>Votos:</b> " + this.y
        }
      },
      credits: {
        enabled: false
      }
    });
  });
</script>